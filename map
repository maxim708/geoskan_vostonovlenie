# Данные с дрона - фотографии и их координаты
from google.colab import files
import os

print("Пожалуйста, загрузите файл через диалоговое окно:")
uploaded = files.upload()

# Define output directory for map and images
output_directory = "maps"
os.makedirs(output_directory, exist_ok=True) # Ensure directory exists before saving image

данные_дрона = []
if uploaded:
    for uploaded_filename, uploaded_content in uploaded.items():
        # Save the uploaded image to the output_directory
        image_path_in_colab = os.path.join(output_directory, uploaded_filename)
        with open(image_path_in_colab, "wb") as f:
            f.write(uploaded_content)

        # Add the saved filename and fixed coordinates to данные_дрона
        данные_дрона.append({"фото": uploaded_filename, "lat": 43.286802, "lon": 41.617869})
else:
    print("No file uploaded. Map will be generated without placemarks.")


# Создаем HTML с Яндекс.Картой
html = """<!DOCTYPE html>
<html>
<head>
    <meta charset=\"utf-8\">
    <title>Фото с дрона на Яндекс.Карте</title>
</head>
<body>
    <h1>Фотографии с дрона</h1>

    <div id=\"map\" style=\"width: 800px; height: 600px\"></div>

    <script src=\"https://api-maps.yandex.ru/2.1/?lang=ru_RU\"></script>
    <script>
        // Создаем карту
        ymaps.ready(init);

        function init() {
            var map = new ymaps.Map('map', {
                center: [43.286802, 41.617869],
                zoom: 15
            });

            // Добавляем метки
"""

# Добавляем метки для каждой фотографии
for i, точка in enumerate(данные_дрона):
    filename = точка['фото'] # This is now the actual filename string
    html += f"""
            // Метка для {filename}
            var placemark{i} = new ymaps.Placemark([{точка['lat']}, {точка['lon']}], {{
                balloonContent: '<strong>{filename}</strong><br>' +
                              'Координаты: {точка['lat']}, {точка['lon']}<br>' +
                              '<img src=\"{filename}\" width=\"150\">' // Add img tag here
            }});
            map.geoObjects.add(placemark{i});
"""

html += """
        }
    </script>
</body>
</html>
"""

# Указываем путь для сохранения файла (output_directory already defined and created above)
file_name = "yandex_map.html"
output_path = os.path.join(output_directory, file_name)

# Сохраняем HTML файл
with open(output_path, "w", encoding="utf-8") as f:
    f.write(html)

print(f"✅ Карта создана: {output_path}")
print(f"✅ Добавлено {len(данные_дрона)} фотографий")
print(f"\nОткройте файл {output_path} в браузере (это путь внутри Colab). Для загрузки файла на ваш компьютер используйте команду: files.download('{output_path}')")

# Automatic download removed as per user request
